<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Pabulib{% endblock %}</title>
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('main.static', filename='favicon/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('main.static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('main.static', filename='favicon/favicon-16x16.png') }}">
    <link rel="mask-icon" href="{{ url_for('main.static', filename='favicon/safari-pinned-tab.svg') }}" color="#5bbad5">
    <link rel="manifest" href="{{ url_for('main.static', filename='manifest.json') }}">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'sans': ['Raleway', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <link rel="stylesheet" href="{{ url_for('main.static', filename='styles.css') }}" />
    
    {% if google_analytics_id %}
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ google_analytics_id }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ google_analytics_id }}', {
        // Privacy-friendly settings
        anonymize_ip: true,
        allow_google_signals: false,
        allow_ad_personalization_signals: false,
        // Custom parameters for better segmentation
        custom_map: {
          'custom_parameter_1': 'user_type',
          'custom_parameter_2': 'session_datasets_viewed',
          'custom_parameter_3': 'session_downloads_count'
        }
      });
      
      // Make analytics ID available to other scripts
      window.googleAnalyticsId = '{{ google_analytics_id }}';
    </script>
    
    <!-- Enhanced Analytics for Pabulib -->
    <script src="{{ url_for('main.static', filename='js/analytics-ga4.js') }}"></script>
    {% endif %}
    
    {% block head %}{% endblock %}
  </head>
  <body class="{% block bodyClass %} bg-slate-50{% endblock %}">
  <nav id="mainNav" class="bg-slate-900 text-white px-4 sticky top-0 z-50 h-16 flex items-center shadow-sm w-full">
      <!-- Mobile hamburger -->
      <button id="navToggle" class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-slate-300 hover:text-white hover:bg-slate-700 focus:outline-none" aria-controls="navLinks" aria-expanded="false" aria-label="Toggle navigation">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
  <!-- Spacer only on small screens so the hamburger doesn't collide; hidden on desktop to keep links centered -->
  <div class="flex-1 md:hidden"></div>
      <!-- Links -->
  <div id="navLinks" class="hidden fixed left-0 right-0 top-16 bg-slate-900 border-t border-slate-800 shadow-lg md:shadow-none md:border-0 md:static md:flex md:space-x-6 md:justify-center mx-auto md:bg-transparent z-10">
        <a href="{{ url_for('main.home') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.home') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Search</a>
        <a href="{{ url_for('main.format_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.format_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Data format</a>
        <a href="{{ url_for('main.statistics_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.statistics_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Statistics</a>
  <a href="{{ url_for('main.details_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.details_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Details</a>
        <a href="{{ url_for('main.tools_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.tools_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Tools</a>
        <a href="{{ url_for('main.upload_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.endpoint == 'main.upload_page' else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Upload &amp; Check</a>
  <a href="{{ url_for('main.citations_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.citations_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Citations</a>
        <a href="{{ url_for('main.about_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.about_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">About</a>
        <a href="{{ url_for('main.contact_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.contact_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Contact</a>
      </div>
    </nav>
    
    <!-- Keep admin bar perfectly aligned under the main nav (no overlap) -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const mainNav = document.getElementById('mainNav');
        const adminNav = document.getElementById('adminNav');
        if (!mainNav || !adminNav) return;
        const setAdminTop = () => { adminNav.style.top = mainNav.offsetHeight + 'px'; };
        setAdminTop();
        window.addEventListener('resize', setAdminTop);
      });
    </script>

    <!-- Mobile nav toggling -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const navToggle = document.getElementById('navToggle');
        const navLinks = document.getElementById('navLinks');
        if (!navToggle || !navLinks) return;

        function closeNav(){
          if (window.innerWidth < 768) {
            navLinks.classList.add('hidden');
          }
          navToggle.setAttribute('aria-expanded','false');
        }
        function openNav(){
          navLinks.classList.remove('hidden');
          navToggle.setAttribute('aria-expanded','true');
        }
        navToggle.addEventListener('click', (e)=>{
          e.stopPropagation();
          if(navLinks.classList.contains('hidden')) openNav(); else closeNav();
        });
        document.addEventListener('click', (e)=>{
          if (window.innerWidth >= 768) return; // desktop always visible via md:flex
          if (!navLinks.contains(e.target) && !navToggle.contains(e.target)) {
            closeNav();
          }
        });
        window.addEventListener('resize', ()=>{
          if(window.innerWidth >= 768){
            navLinks.classList.remove('hidden');
            navToggle.setAttribute('aria-expanded','false');
          } else {
            navLinks.classList.add('hidden');
          }
        });
        
        // Shorten tab names if small screen
        function adjustNavText() {
          const links = navLinks.querySelectorAll('a');
          const isNarrow = window.innerWidth < 1200 && window.innerWidth >= 768;
          
          links.forEach(link => {
            const originalText = link.getAttribute('data-original-text') || link.textContent;
            if (!link.hasAttribute('data-original-text')) {
              link.setAttribute('data-original-text', originalText);
            }
            
            if (isNarrow) {
              if (originalText === 'Data format') {
                link.textContent = 'Format';
              } else if (originalText === 'Upload & Check') {
                link.textContent = 'Upload';
              } else if (originalText === 'Statistics') {
                link.textContent = 'Stats';
              } else if (originalText === 'Citations') {
                link.textContent = 'Cite';
              }
            } else {
              link.textContent = originalText;
            }
          });
        }
        
        adjustNavText();
        window.addEventListener('resize', adjustNavText);
      });
    </script>

    <div class="pt-0"></div>
    {% block body %}{% endblock %}

    {% block scripts %}{% endblock %}
  </body>
</html>
