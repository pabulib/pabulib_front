<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Pabulib{% endblock %}</title>
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('main.static', filename='favicon/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('main.static', filename='favicon/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('main.static', filename='favicon/favicon-16x16.png') }}">
    <link rel="mask-icon" href="{{ url_for('main.static', filename='favicon/safari-pinned-tab.svg') }}" color="#5bbad5">
    <link rel="manifest" href="{{ url_for('main.static', filename='manifest.json') }}">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'sans': ['Raleway', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <link rel="stylesheet" href="{{ url_for('main.static', filename='styles.css') }}" />
    {% block head %}{% endblock %}
  </head>
  <body class="{% block bodyClass %} bg-slate-50{% endblock %}">
  <nav id="mainNav" class="bg-slate-900 text-white px-4 sticky top-0 z-50 h-16 flex items-center shadow-sm w-full">
      <!-- Mobile hamburger -->
      <button id="navToggle" class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-slate-300 hover:text-white hover:bg-slate-700 focus:outline-none" aria-controls="navLinks" aria-expanded="false" aria-label="Toggle navigation">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
  <!-- Spacer only on small screens so the hamburger doesn't collide; hidden on desktop to keep links centered -->
  <div class="flex-1 md:hidden"></div>
      <!-- Links -->
  <div id="navLinks" class="hidden fixed left-0 right-0 top-16 bg-slate-900 border-t border-slate-800 shadow-lg md:shadow-none md:border-0 md:static md:flex md:space-x-6 md:justify-center mx-auto md:bg-transparent z-10">
        <a href="{{ url_for('main.home') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.home') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Search</a>
        <a href="{{ url_for('main.format_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.format_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Data format</a>
        <a href="{{ url_for('main.statistics_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.statistics_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Statistics</a>
        <a href="{{ url_for('main.comments_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.comments_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Comments</a>
        <a href="{{ url_for('main.tools_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.tools_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Tools</a>
        <a href="{{ url_for('main.upload_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.endpoint == 'main.upload_page' else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Upload &amp; Check</a>
        <a href="{{ url_for('main.publications_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.publications_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Publications</a>
        <a href="{{ url_for('main.about_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.about_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">About</a>
        <a href="{{ url_for('main.contact_page') }}" class="block px-3 py-3 md:py-2 rounded-md text-lg font-medium transition-colors {{ 'bg-indigo-800 text-white' if request.path == url_for('main.contact_page') else 'text-slate-300 hover:bg-slate-700 hover:text-white' }}">Contact</a>
      </div>
    </nav>
    
    <!-- Keep admin bar perfectly aligned under the main nav (no overlap) -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const mainNav = document.getElementById('mainNav');
        const adminNav = document.getElementById('adminNav');
        if (!mainNav || !adminNav) return;
        const setAdminTop = () => { adminNav.style.top = mainNav.offsetHeight + 'px'; };
        setAdminTop();
        window.addEventListener('resize', setAdminTop);
      });
    </script>

    <!-- Mobile nav toggling -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const navToggle = document.getElementById('navToggle');
        const navLinks = document.getElementById('navLinks');
        if (!navToggle || !navLinks) return;

        function closeNav(){
          if (window.innerWidth < 768) {
            navLinks.classList.add('hidden');
          }
          navToggle.setAttribute('aria-expanded','false');
        }
        function openNav(){
          navLinks.classList.remove('hidden');
          navToggle.setAttribute('aria-expanded','true');
        }
        navToggle.addEventListener('click', (e)=>{
          e.stopPropagation();
          if(navLinks.classList.contains('hidden')) openNav(); else closeNav();
        });
        document.addEventListener('click', (e)=>{
          if (window.innerWidth >= 768) return; // desktop always visible via md:flex
          if (!navLinks.contains(e.target) && !navToggle.contains(e.target)) {
            closeNav();
          }
        });
        window.addEventListener('resize', ()=>{
          if(window.innerWidth >= 768){
            navLinks.classList.remove('hidden');
            navToggle.setAttribute('aria-expanded','false');
          } else {
            navLinks.classList.add('hidden');
          }
        });
      });
    </script>

    <!-- Refactoring Notice Popup -->
    <div id="refactoringNotice" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" style="display: none;">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6 relative">
        <div class="flex items-center mb-4">
          <div class="flex-shrink-0">
            <svg class="h-8 w-8 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
          </div>
          <h3 class="ml-3 text-lg font-medium text-gray-900">Website Under Refactoring</h3>
        </div>
        <div class="mb-6">
          <p class="text-gray-600 text-sm leading-relaxed mb-3">
            We're currently refactoring our webpage to improve your experience. Some functionalities might not work as expected during this process.
          </p>
          <p class="text-gray-600 text-sm leading-relaxed">
            If you find something crucial or annoying, please reach out to us at:
          </p>
          <p class="text-indigo-600 font-medium text-sm mt-1 text-center">
            <a href="mailto:pabulib@uj.edu.pl" class="hover:text-indigo-800 transition-colors">pabulib@uj.edu.pl</a>
          </p>
        </div>
        <div class="flex justify-end space-x-3">
          <button id="hideNoticeSession" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
            Hide for this session
          </button>
          <button id="hideNoticeWeek" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md transition-colors">
            Don't show for a week
          </button>
        </div>
      </div>
    </div>

    <div class="pt-0"></div>
    {% block body %}{% endblock %}

    <script>      
      // Refactoring notice popup
      document.addEventListener('DOMContentLoaded', function() {
        const notice = document.getElementById('refactoringNotice');
        const hideSession = document.getElementById('hideNoticeSession');
        const hideWeek = document.getElementById('hideNoticeWeek');
        
        // Check if notice should be shown
        const hiddenUntil = localStorage.getItem('refactoringNoticeHidden');
        const sessionHidden = sessionStorage.getItem('refactoringNoticeHidden');
        
        if (!sessionHidden && (!hiddenUntil || new Date().getTime() > parseInt(hiddenUntil))) {
          notice.style.display = 'flex';
        }
        
        // Hide for session
        hideSession.addEventListener('click', function() {
          sessionStorage.setItem('refactoringNoticeHidden', 'true');
          notice.style.display = 'none';
        });
        
        // Hide for a week
        hideWeek.addEventListener('click', function() {
          const weekFromNow = new Date().getTime() + (7 * 24 * 60 * 60 * 1000);
          localStorage.setItem('refactoringNoticeHidden', weekFromNow.toString());
          notice.style.display = 'none';
        });
        
        // Close on background click
        notice.addEventListener('click', function(e) {
          if (e.target === notice) {
            sessionStorage.setItem('refactoringNoticeHidden', 'true');
            notice.style.display = 'none';
          }
        });
      });
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
